# CollisionPro Environment Variables Setup Guide

## ðŸš€ Quick Start Checklist

Copy this file to `.env.local` and fill in your actual values.

---

## âœ… REQUIRED - Core Application (Must have to run)

### 1. Next.js Configuration
```bash
# Base URL for your application
NEXT_PUBLIC_APP_URL=http://localhost:3000
# Or for production:
# NEXT_PUBLIC_APP_URL=https://yourdomain.com
```

### 2. Supabase Database (CRITICAL)
```bash
# Get from: https://supabase.com/dashboard > Project Settings > API
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key_here

# Get from: https://supabase.com/dashboard > Project Settings > API > Service Role
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
```

**Setup Steps:**
1. Go to https://supabase.com
2. Create new project (free tier available)
3. Wait for database to provision (~2 minutes)
4. Go to Project Settings > API
5. Copy:
   - URL â†’ `NEXT_PUBLIC_SUPABASE_URL`
   - anon/public key â†’ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - service_role key â†’ `SUPABASE_SERVICE_ROLE_KEY`

### 3. NextAuth.js (Authentication)
```bash
# Generate with: openssl rand -base64 32
NEXTAUTH_SECRET=your_generated_secret_here

# Your app URL (same as NEXT_PUBLIC_APP_URL)
NEXTAUTH_URL=http://localhost:3000
# Or for production:
# NEXTAUTH_URL=https://yourdomain.com
```

**Setup Steps:**
1. Open terminal/PowerShell
2. Run: `openssl rand -base64 32`
3. Copy the output to `NEXTAUTH_SECRET`

---

## â­ RECOMMENDED - Enhanced Features (Highly recommended)

### 4. Twilio SMS (Customer Notifications)
```bash
TWILIO_ACCOUNT_SID=your_account_sid_here
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_PHONE_NUMBER=+1234567890
```

**Features Enabled:**
- âœ… SMS notifications to customers
- âœ… Estimate status updates
- âœ… Appointment reminders
- âœ… Payment confirmations

**Setup Steps:**
1. Sign up at https://twilio.com (free trial: $15 credit)
2. Go to Console Dashboard
3. Copy Account SID and Auth Token
4. Go to Phone Numbers > Buy a number (or use trial number)
5. Copy your phone number with country code (+1...)

**Cost:** ~$0.0075 per SMS (after free trial)

### 5. Stripe Payments (Customer Portal)
```bash
STRIPE_SECRET_KEY=your_stripe_secret_key_here
STRIPE_PUBLISHABLE_KEY=your_stripe_publishable_key_here
STRIPE_WEBHOOK_SECRET=your_webhook_secret_here
```

**Features Enabled:**
- âœ… Online customer payments
- âœ… Deductible collection
- âœ… Payment tracking
- âœ… Automatic receipt generation

**Setup Steps:**
1. Sign up at https://stripe.com
2. Activate your account (or use test mode)
3. Go to Developers > API Keys
4. Copy:
   - Secret key â†’ `STRIPE_SECRET_KEY`
   - Publishable key â†’ `STRIPE_PUBLISHABLE_KEY`
5. Go to Developers > Webhooks > Add endpoint
   - URL: `https://yourdomain.com/api/payments/webhook`
   - Events: `checkout.session.completed`, `checkout.session.expired`
6. Copy Signing secret â†’ `STRIPE_WEBHOOK_SECRET`

**Cost:** 2.9% + $0.30 per transaction

### 6. OpenAI (AI Damage Analysis)
```bash
OPENAI_API_KEY=your_openai_api_key_here
```

**Features Enabled:**
- âœ… AI photo damage analysis
- âœ… Damage severity detection
- âœ… Part identification
- âœ… Supplement suggestions

**Setup Steps:**
1. Sign up at https://platform.openai.com
2. Add payment method (required)
3. Go to API Keys
4. Create new secret key
5. Copy to `OPENAI_API_KEY`

**Cost:**
- GPT-4 Vision: ~$0.01 per image analysis
- Typical: $5-20/month for small shop

---

## ðŸŽ¯ OPTIONAL - Advanced Integrations

### 7. Insurance DRP Integration (Future)

#### CCC ONE
```bash
CCC_ONE_API_KEY=your_ccc_api_key
CCC_ONE_SHOP_ID=your_shop_id
CCC_ONE_ENVIRONMENT=sandbox  # or 'production'
```

#### Mitchell
```bash
MITCHELL_API_KEY=your_mitchell_api_key
MITCHELL_SHOP_CODE=your_shop_code
MITCHELL_ENVIRONMENT=test  # or 'production'
```

#### Audatex
```bash
AUDATEX_API_KEY=your_audatex_api_key
AUDATEX_SHOP_ID=your_shop_id
AUDATEX_ENVIRONMENT=staging  # or 'production'
```

**Note:** These require DRP agreements with insurance companies. Not needed for initial launch.

### 8. SendGrid (Email Notifications)
```bash
SENDGRID_API_KEY=your_sendgrid_api_key
SENDGRID_FROM_EMAIL=noreply@yourdomain.com
```

**Features:**
- Email estimates to customers
- Email notifications
- Estimate PDFs via email

**Setup:**
1. Sign up at https://sendgrid.com (free tier: 100 emails/day)
2. Go to Settings > API Keys
3. Create API key
4. Verify sender email address

**Cost:** Free tier sufficient for most shops

### 9. Google Maps (Shop Locations)
```bash
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=your_google_maps_key
```

**Features:**
- Shop location map
- Distance calculations
- Address autocomplete

**Setup:**
1. Go to https://console.cloud.google.com
2. Enable Maps JavaScript API
3. Create API key
4. Restrict to your domain

**Cost:** $200 free credit/month (usually sufficient)

### 10. Sentry (Error Tracking)
```bash
NEXT_PUBLIC_SENTRY_DSN=your_sentry_dsn
SENTRY_AUTH_TOKEN=your_auth_token
```

**Features:**
- Production error tracking
- Performance monitoring
- User feedback

**Setup:**
1. Sign up at https://sentry.io
2. Create new project (Next.js)
3. Copy DSN

**Cost:** Free tier: 5,000 errors/month

---

## ðŸ“‹ Complete .env.local Template

```bash
# ============================================================
# REQUIRED - Must have these to run the application
# ============================================================

# Next.js
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXTAUTH_SECRET=generate_with_openssl_rand_base64_32
NEXTAUTH_URL=http://localhost:3000

# Supabase (Database)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# ============================================================
# RECOMMENDED - Highly recommended for full functionality
# ============================================================

# Twilio SMS
TWILIO_ACCOUNT_SID=your_account_sid
TWILIO_AUTH_TOKEN=your_auth_token
TWILIO_PHONE_NUMBER=+1234567890

# Stripe Payments
STRIPE_SECRET_KEY=your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=your_stripe_publishable_key
STRIPE_WEBHOOK_SECRET=your_webhook_secret

# OpenAI (AI Features)
OPENAI_API_KEY=your_openai_api_key

# ============================================================
# OPTIONAL - Nice to have, not critical
# ============================================================

# SendGrid Email
SENDGRID_API_KEY=your_sendgrid_key
SENDGRID_FROM_EMAIL=noreply@yourdomain.com

# Google Maps
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=your_google_maps_key

# Sentry Error Tracking
NEXT_PUBLIC_SENTRY_DSN=your_sentry_dsn
SENTRY_AUTH_TOKEN=your_auth_token

# ============================================================
# FUTURE - Insurance DRP (when you have agreements)
# ============================================================

# CCC ONE
CCC_ONE_API_KEY=
CCC_ONE_SHOP_ID=
CCC_ONE_ENVIRONMENT=sandbox

# Mitchell
MITCHELL_API_KEY=
MITCHELL_SHOP_CODE=
MITCHELL_ENVIRONMENT=test

# Audatex
AUDATEX_API_KEY=
AUDATEX_SHOP_ID=
AUDATEX_ENVIRONMENT=staging
```

---

## ðŸŽ¯ Minimum Viable Setup (To Get Started Today)

**Just need these 3 services:**

1. âœ… **Supabase** (FREE)
   - Database + authentication
   - 500MB storage free

2. âœ… **NextAuth Secret** (FREE)
   - Just run `openssl rand -base64 32`

3. âœ… **Twilio** (FREE trial)
   - $15 credit = ~2,000 SMS messages
   - Enough to test and onboard first shops

**Total cost to start: $0**

---

## ðŸ’° Recommended Production Setup

**Monthly costs for a small shop (50 estimates/month):**

| Service | Monthly Cost | What You Get |
|---------|--------------|--------------|
| Supabase | $0 (Free tier) | Database, Auth, Storage |
| Twilio | ~$5-10 | SMS notifications |
| Stripe | $0 base + 2.9% | Payment processing |
| OpenAI | ~$10-20 | AI damage analysis |
| SendGrid | $0 (Free tier) | Email notifications |
| **TOTAL** | **~$15-30/month** | Full featured system |

**Compare to:**
- Mitchell: $500-1,500/month
- CCC ONE: $400-1,200/month
- Audatex: $450-1,300/month

---

## ðŸ”’ Security Best Practices

1. **Never commit .env.local to git**
   - Already in .gitignore
   - Contains sensitive API keys

2. **Use different keys for dev/production**
   - Test mode for Stripe in development
   - Sandbox for Twilio in development

3. **Rotate keys regularly**
   - Especially if team members leave
   - At least every 90 days

4. **Restrict API keys**
   - Limit Stripe webhooks to your domain
   - Restrict Google Maps to your domain
   - Use IP restrictions where available

---

## ðŸ“ž Support Resources

- **Supabase Docs:** https://supabase.com/docs
- **Twilio Console:** https://console.twilio.com
- **Stripe Dashboard:** https://dashboard.stripe.com
- **OpenAI Platform:** https://platform.openai.com

---

## âœ… Verification Checklist

After setting up your .env.local:

- [ ] Application starts without errors (`npm run dev`)
- [ ] Can register a new user account
- [ ] Can create a new estimate
- [ ] Can upload photos
- [ ] SMS test message sends (if Twilio configured)
- [ ] Can run migrations: `node scripts/run-all-migrations.js`
- [ ] Build succeeds: `npm run build`

---

**Ready to deploy?** See DEPLOYMENT.md for production setup guide.
